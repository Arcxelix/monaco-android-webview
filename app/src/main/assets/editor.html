<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monaco in Android WebView</title>
  <style>
    html, body, #container { height: 100%; margin: 0; padding: 0; }
    #topbar { height: 48px; display: flex; align-items: center; padding: 0 12px; border-bottom: 1px solid #ddd; }
    #container { height: calc(100% - 48px); }
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; background: #f7f7f7; }
  </style>
</head>
<body>
  <div id="topbar">
    <button onclick="AndroidBridge.saveText(window.editor.getValue())">Save to app files</button>
  </div>
  <div id="container"></div>

  <!-- Load Monaco from local assets (downloaded during CI) -->
  <script src="https://appassets.androidplatform.net/assets/vs/loader.js"></script>
  <script>
    // Point AMD loader to our local 'vs' folder in assets
    require.config({ paths: { 'vs': 'https://appassets.androidplatform.net/assets/vs' } });

    // Minimal Kotlin highlighting (Monarch) â€“ fallback if Kotlin not bundled
    const kotlinTokens = {
      defaultToken: '',
      tokenPostfix: '.kt',
      keywords: ['as','break','class','continue','do','else','false','for','fun','if','in','interface','is','null','object','package','return','super','this','throw','true','try','typealias','val','var','when','while','by','catch','constructor','delegate','dynamic','field','file','finally','get','import','init','param','property','receiver','set','setparam','where'],
      operators: ['=','>','<','!','~','?',':','==','<=','>=','!=','&&','||','++','--','+','-','*','/','&','|','^','%','<<','>>','>>>','+=','-=','*=','/=','&=','|=','^=','%=','<<=','>>=','>>>='],
      symbols: /[=><!~?:&|+\-*\/\^%]+/,
      tokenizer: {
        root: [
          [/\b([A-Za-z_][\w]*)\b/, {
            cases: {
              '@keywords': 'keyword',
              '@default': 'identifier'
            }
          }],
          { include: '@whitespace' },
          [/[{}\[\]()]/, '@brackets'],
          [/@symbols/, {
            cases: {
              '@operators': 'operator',
              '@default': ''
            }
          }],
          [/\d+(\.\d+)?([eE][\-+]?\d+)?[fFdD]?/, 'number'],
          [/"([^"\\]|\\.)*"/, 'string'],
          [/'''[^]*?'''/, 'string'],
          [/'.'/, 'string']
        ],
        whitespace: [
          [/\s+/, 'white'],
          [/(\/\*([^*]|\*(?!\/))*\*\/)|(\/\/.*$)/, 'comment'],
        ]
      }
    };

    require(['vs/editor/editor.main'], function() {
      // Register simple Kotlin language if not present
      const langs = monaco.languages.getLanguages().map(l => l.id);
      if (!langs.includes('kotlin')) {
        monaco.languages.register({ id: 'kotlin' });
        monaco.languages.setMonarchTokensProvider('kotlin', kotlinTokens);
      }

      window.editor = monaco.editor.create(document.getElementById('container'), {
        value: `fun main() {\n    println("Hello from Monaco on Android!")\n}`,
        language: 'kotlin',
        theme: 'vs-dark',
        automaticLayout: true,
        minimap: { enabled: false }
      });
    });
  </script>
</body>
</html>
